# Placeholder CRD - will be generated by `make generate` using controller-gen.
# This file is committed so that `helm install` works without requiring
# controller-gen to be installed locally.
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: audiciapolicyreports.audicia.io
  annotations:
    controller-gen.kubebuilder.io/version: (devel)
spec:
  group: audicia.io
  names:
    kind: AudiciaPolicyReport
    listKind: AudiciaPolicyReportList
    plural: audiciapolicyreports
    singular: audiciapolicyreport
    shortNames:
      - apr
      - apreport
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      additionalPrinterColumns:
        - name: Subject
          type: string
          jsonPath: .spec.subject.name
        - name: Kind
          type: string
          jsonPath: .spec.subject.kind
        - name: Compliance
          type: string
          jsonPath: .status.compliance.severity
        - name: Score
          type: integer
          jsonPath: .status.compliance.score
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
        - name: Needed
          type: integer
          jsonPath: .status.compliance.usedCount
          description: RBAC rules actually exercised
          priority: 1
        - name: Excess
          type: integer
          jsonPath: .status.compliance.excessCount
          description: RBAC rules granted but never used
          priority: 1
        - name: Ungranted
          type: integer
          jsonPath: .status.compliance.uncoveredCount
          description: observed actions without RBAC grant
          priority: 1
        - name: Sensitive
          type: boolean
          jsonPath: .status.compliance.hasSensitiveExcess
          description: excess grants on sensitive resources
          priority: 1
        - name: Audit Events
          type: integer
          jsonPath: .status.eventsProcessed
          description: total audit events processed
          priority: 1
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          type: object
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              type: object
              properties:
                subject:
                  type: object
                  required: ["kind", "name"]
                  properties:
                    kind:
                      type: string
                      enum: ["ServiceAccount", "User", "Group"]
                    name:
                      type: string
                      minLength: 1
                    namespace:
                      type: string
            status:
              type: object
              properties:
                observedRules:
                  type: array
                  items:
                    type: object
                    properties:
                      apiGroups:
                        type: array
                        items:
                          type: string
                      resources:
                        type: array
                        items:
                          type: string
                      verbs:
                        type: array
                        items:
                          type: string
                      nonResourceURLs:
                        type: array
                        items:
                          type: string
                      firstSeen:
                        type: string
                        format: date-time
                      lastSeen:
                        type: string
                        format: date-time
                      namespace:
                        type: string
                      count:
                        type: integer
                        format: int64
                        minimum: 1
                suggestedPolicy:
                  type: object
                  properties:
                    manifests:
                      type: array
                      items:
                        type: string
                compliance:
                  type: object
                  properties:
                    score:
                      type: integer
                      format: int32
                    severity:
                      type: string
                      enum: ["Green", "Yellow", "Red"]
                    usedCount:
                      type: integer
                      format: int32
                    excessCount:
                      type: integer
                      format: int32
                    uncoveredCount:
                      type: integer
                      format: int32
                    hasSensitiveExcess:
                      type: boolean
                    sensitiveExcess:
                      type: array
                      items:
                        type: string
                    lastEvaluatedTime:
                      type: string
                      format: date-time
                eventsProcessed:
                  type: integer
                  format: int64
                lastProcessedTime:
                  type: string
                  format: date-time
                conditions:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
                      reason:
                        type: string
                      message:
                        type: string
                      observedGeneration:
                        type: integer
                        format: int64
