# Placeholder CRD - will be generated by `make generate` using controller-gen.
# This file is committed so that `helm install` works without requiring
# controller-gen to be installed locally.
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: audiciasources.audicia.io
  annotations:
    controller-gen.kubebuilder.io/version: (devel)
spec:
  group: audicia.io
  names:
    kind: AudiciaSource
    listKind: AudiciaSourceList
    plural: audiciasources
    singular: audiciasource
    shortNames:
      - as
      - asrc
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      additionalPrinterColumns:
        - name: Source Type
          type: string
          jsonPath: .spec.sourceType
        - name: Scope Mode
          type: string
          jsonPath: .spec.policyStrategy.scopeMode
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          type: object
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              type: object
              properties:
                sourceType:
                  type: string
                  enum: ["K8sAuditLog", "Webhook"]
                location:
                  type: object
                  properties:
                    path:
                      type: string
                      minLength: 1
                webhook:
                  type: object
                  properties:
                    port:
                      type: integer
                      minimum: 1
                      maximum: 65535
                      default: 8443
                    tlsSecretName:
                      type: string
                    clientCASecretName:
                      type: string
                    rateLimitPerSecond:
                      type: integer
                      minimum: 1
                      default: 100
                    maxRequestBodyBytes:
                      type: integer
                      minimum: 1024
                      default: 1048576
                policyStrategy:
                  type: object
                  properties:
                    scopeMode:
                      type: string
                      enum: ["NamespaceStrict", "ClusterScopeAllowed"]
                      default: NamespaceStrict
                    verbMerge:
                      type: string
                      enum: ["Smart", "Exact"]
                      default: Smart
                    wildcards:
                      type: string
                      enum: ["Forbidden", "Safe"]
                      default: Forbidden
                    resourceNames:
                      type: string
                      enum: ["Omit", "Explicit"]
                      default: Omit
                filters:
                  type: array
                  items:
                    type: object
                    properties:
                      action:
                        type: string
                        enum: ["Allow", "Deny"]
                      userPattern:
                        type: string
                      namespacePattern:
                        type: string
                ignoreSystemUsers:
                  type: boolean
                  default: true
                checkpoint:
                  type: object
                  properties:
                    intervalSeconds:
                      type: integer
                      minimum: 5
                      default: 30
                    batchSize:
                      type: integer
                      minimum: 1
                      default: 500
                limits:
                  type: object
                  properties:
                    maxRulesPerReport:
                      type: integer
                      minimum: 1
                      default: 200
                    retentionDays:
                      type: integer
                      minimum: 1
                      default: 30
            status:
              type: object
              properties:
                fileOffset:
                  type: integer
                  format: int64
                lastTimestamp:
                  type: string
                  format: date-time
                inode:
                  type: integer
                  format: int64
                conditions:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
                      reason:
                        type: string
                      message:
                        type: string
                      observedGeneration:
                        type: integer
                        format: int64
