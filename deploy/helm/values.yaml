# Default values for audicia-operator.

# -- Number of replicas. Only 1 is needed (leader election handles HA).
replicaCount: 1

image:
  # -- Container image repository.
  repository: felixnotka/audicia-operator
  # -- Image pull policy.
  pullPolicy: Always
  # -- Overrides the image tag (default is the chart appVersion).
  tag: ""

# -- Image pull secrets for private registries.
imagePullSecrets: []

# -- Override the release name.
nameOverride: ""
# -- Override the full release name.
fullnameOverride: ""

serviceAccount:
  # -- Whether to create a ServiceAccount.
  create: true
  # -- Annotations to add to the ServiceAccount.
  annotations: {}
  # -- The name of the ServiceAccount. If not set, a name is generated.
  name: ""

# -- Pod annotations.
podAnnotations: {}

# -- Pod security context.
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 10000
  fsGroup: 10000

# -- Container security context.
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

operator:
  # -- Metrics bind address.
  metricsBindAddress: ":8080"
  # -- Health probe bind address.
  healthProbeBindAddress: ":8081"
  # -- Enable leader election.
  leaderElection:
    enabled: true
  # -- Log level (0=info, 1=debug).
  logLevel: 0

# -- Resource requests and limits.
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 256Mi

# -- Node selector.
nodeSelector: {}

# -- Tolerations.
tolerations: []

# -- Affinity rules.
affinity: {}

# Audit log volume configuration.
auditLog:
  # -- Enable mounting the audit log volume.
  enabled: false
  # -- Host path to the audit log file.
  hostPath: /var/log/kube-audit.log

# Webhook audit event receiver configuration.
webhook:
  # -- Enable the webhook audit event receiver.
  enabled: false
  # -- HTTPS port for the webhook receiver.
  port: 8443
  # -- Name of an existing TLS Secret (must contain tls.crt and tls.key).
  # Required when webhook.enabled is true. Create with:
  #   kubectl create secret tls audicia-webhook-tls \
  #     --cert=server.crt --key=server.key -n audicia-system
  tlsSecretName: ""
  # -- Name of a Secret containing a CA bundle (ca.crt) for mTLS client
  # certificate verification. When set, only clients presenting a certificate
  # signed by this CA are accepted (typically the kube-apiserver).
  # Optional but recommended for production.
  clientCASecretName: ""
  # -- Expose the webhook port on the host via hostPort. When the operator
  # runs on the control plane node, this lets the kube-apiserver reach it
  # via localhost:<port> — bypassing ClusterIP routing issues with some CNIs
  # (e.g. Cilium without kube-proxy). Recommended for single-node or
  # dedicated control plane setups.
  hostPort: false
  service:
    # -- Fixed ClusterIP for the webhook Service. Set this so the IP stays
    # the same across helm uninstall/install cycles — the kube-apiserver
    # webhook kubeconfig references this IP directly (it runs on hostNetwork
    # and cannot resolve cluster DNS). Pick any free IP from your cluster's
    # service CIDR (kubeadm default: 10.96.0.0/12). Leave empty for auto-assignment.
    clusterIP: ""
    # -- Fixed NodePort for the webhook Service. When set, the service type
    # is changed to NodePort and the webhook is reachable at <nodeIP>:<nodePort>.
    # Useful when ClusterIP is not reachable from the host namespace.
    # Must be in the range 30000-32767. Leave empty to use ClusterIP.
    nodePort: ""
  networkPolicy:
    # -- Create a NetworkPolicy restricting webhook ingress to the kube-apiserver.
    enabled: false
    # -- CIDR of your control plane node(s). Required when networkPolicy.enabled is true.
    # Find it with: kubectl get nodes -o wide | grep control-plane
    # For a single node use /32 (e.g. 162.55.131.175/32).
    controlPlaneCIDR: ""

# Cloud audit log ingestion configuration (AKS Event Hub, EKS CloudWatch, GKE Pub/Sub).
cloudAuditLog:
  # -- Enable cloud-based audit log ingestion.
  enabled: false
  # -- Cloud provider: AzureEventHub, AWSCloudWatch, or GCPPubSub.
  provider: ""
  # -- Name of a Secret containing cloud credentials (e.g., Event Hub connection string).
  # The Secret must exist in the release namespace. Key: "connection-string".
  # Leave empty for managed identity / workload identity.
  credentialSecretName: ""
  # -- Cluster identity string for event validation. Format varies by provider:
  # AKS: resource ID (/subscriptions/.../managedClusters/<name>)
  # EKS: cluster ARN
  # GKE: cluster resource name
  clusterIdentity: ""
  # Azure Event Hub configuration.
  azure:
    # -- Fully qualified Event Hub namespace (e.g., "myns.servicebus.windows.net").
    eventHubNamespace: ""
    # -- Event Hub instance name.
    eventHubName: ""
    # -- Consumer group name.
    consumerGroup: "$Default"
    # -- Azure Blob Storage URL for checkpoint persistence.
    # If empty, checkpoints are stored in AudiciaSource status only.
    storageAccountURL: ""
    # -- Blob container name for checkpoints.
    storageContainerName: ""

serviceMonitor:
  # -- Whether to create a Prometheus ServiceMonitor.
  enabled: false
  # -- Additional labels for the ServiceMonitor.
  labels: {}
  # -- Scrape interval.
  interval: 30s
